# คู่มือการแปลงข้อมูลโครงการคณะแบบไม่เป็นระเบียบเป็นข้อมูล Tidy Data

## ตัวอย่าง: ข้อมูลโครงการของคณะต่าง ๆ

### ปัญหาข้อมูลที่ไม่เป็นระเบียบ (Untidy Data)

ไฟล์ `untidy_faculty_projects.csv` มีปัญหาต่อไปนี้:

1. **การรวมเซลล์ของคณะ** - คณะไม่ถูกระบุในทุกแถว แต่ใช้การรวมเซลล์แทน
2. **ข้อมูลหัวหน้าโครงการรวมกัน** - ตำแหน่ง ชื่อ นามสกุล และภาควิชารวมกันในคอลัมน์เดียว
3. **ข้อมูลประเภทโครงการรวมกัน** - ใช้เครื่องหมาย / คั่นระหว่างประเภทโครงการต่างๆ
4. **ข้อมูลงบประมาณมีหน่วยรวมอยู่** - มีคำว่า "บาท" และเครื่องหมายคอมม่า
5. **ข้อมูลระยะเวลาโครงการไม่อยู่ในรูปแบบวันที่** - อยู่ในรูปแบบข้อความ เช่น "มกราคม 2565 - ธันวาคม 2565"

### ขั้นตอนการแปลงเป็น Tidy Data

#### ขั้นตอนที่ 1: แก้ไขปัญหาการรวมเซลล์ของคณะ

1. สร้างสำเนา Sheet ใหม่
2. คัดลอกข้อมูลทั้งหมดจาก Sheet เดิม
3. ในคอลัมน์คณะ ให้ระบุชื่อคณะในทุกแถวที่เกี่ยวข้อง:
   - แถวที่ 2-4: "วิทยาศาสตร์"
   - แถวที่ 5-7: "วิศวกรรมศาสตร์"
   - แถวที่ 8-9: "มนุษยศาสตร์"

#### ขั้นตอนที่ 2: แยกข้อมูลหัวหน้าโครงการ

1. เพิ่มคอลัมน์ "ตำแหน่งหัวหน้าโครงการ", "ชื่อหัวหน้าโครงการ", "นามสกุลหัวหน้าโครงการ" และ "ภาควิชา"
2. ใช้ Text to Columns หรือสูตร เพื่อแยกข้อมูล:
   - ตำแหน่งหัวหน้าโครงการ: `=LEFT(C2, FIND(". ", C2) + 1)`
   - ชื่อและนามสกุล: `=MID(C2, FIND(". ", C2) + 2, FIND("(", C2) - FIND(". ", C2) - 3)`
   - ต่อมาแยกชื่อและนามสกุลอีกครั้ง: `=SPLIT(ผลลัพธ์ข้างบน, " ")`
   - ภาควิชา: `=MID(C2, FIND("(", C2) + 1, FIND(")", C2) - FIND("(", C2) - 1)`

#### ขั้นตอนที่ 3: จัดการข้อมูลประเภทโครงการ

1. แยกประเภทโครงการเป็นคอลัมน์บูลีน (0/1) แต่ละประเภท:
   - "ประเภทวิจัย" = 1 ถ้ามีคำว่า "วิจัย" ใน "ประเภทโครงการ", ไม่เช่นนั้น = 0
   - "ประเภทบริการวิชาการ" = 1 ถ้ามีคำว่า "บริการวิชาการ" ใน "ประเภทโครงการ", ไม่เช่นนั้น = 0
   - "ประเภททำนุบำรุงศิลปวัฒนธรรม" = 1 ถ้ามีคำว่า "ทำนุบำรุงศิลปวัฒนธรรม" ใน "ประเภทโครงการ", ไม่เช่นนั้น = 0
   
   ใช้ฟังก์ชัน:
   ```
   =IF(ISNUMBER(SEARCH("วิจัย", D2)), 1, 0)
   =IF(ISNUMBER(SEARCH("บริการวิชาการ", D2)), 1, 0)
   =IF(ISNUMBER(SEARCH("ทำนุบำรุงศิลปวัฒนธรรม", D2)), 1, 0)
   ```

#### ขั้นตอนที่ 4: จัดการข้อมูลงบประมาณ

1. แปลงคอลัมน์งบประมาณให้เป็นตัวเลขล้วน:
   - ลบเครื่องหมายคอมม่า และคำว่า "บาท" ออก
   - ใช้ฟังก์ชัน: `=VALUE(SUBSTITUTE(SUBSTITUTE(E2, ",", ""), " บาท", ""))`

#### ขั้นตอนที่ 5: จัดการข้อมูลระยะเวลาโครงการ

1. แยกวันเริ่มต้นและวันสิ้นสุดโครงการเป็นคนละคอลัมน์:
   - ใช้ Text to Columns โดยใช้ " - " เป็นตัวแบ่ง
   - หรือใช้ฟังก์ชัน:
     - วันเริ่มต้น: `=LEFT(F2, FIND(" - ", F2) - 1)`
     - วันสิ้นสุด: `=RIGHT(F2, LEN(F2) - FIND(" - ", F2) - 2)`
     
2. แปลงข้อความวันที่เป็นรูปแบบวันที่:
   - สร้างตารางแปลงชื่อเดือนเป็นเลข
   - ใช้ฟังก์ชัน VLOOKUP และ DATE เพื่อสร้างวันที่:
     ```
     =DATE(VALUE(RIGHT(วันเริ่มต้น, 4)) - 543, VLOOKUP(LEFT(วันเริ่มต้น, FIND(" ", วันเริ่มต้น) - 1), ตารางแปลงเดือน, 2, FALSE), 1)
     ```

#### ขั้นตอนที่ 6: เพิ่มรหัสโครงการเพื่อให้มีตัวระบุเฉพาะ

1. สร้างรหัสโครงการที่เป็นเอกลักษณ์:
   - ใช้อักษรย่อของคณะ + ปี + ลำดับโครงการในคณะ
   - เช่น "SCI-2565-001", "ENG-2565-001", "HUM-2565-001"

### ประโยชน์ของข้อมูลที่ปรับเป็น Tidy Data

เมื่อปรับเป็น Tidy Data แล้ว คุณสามารถทำสิ่งต่อไปนี้ได้อย่างง่ายดาย:

1. **การกรองและเรียงลำดับข้อมูล** - กรองโครงการตามประเภท, คณะ, งบประมาณ, ระยะเวลา
2. **การวิเคราะห์งบประมาณ** - คำนวณงบประมาณรวมตามประเภทโครงการหรือตามคณะ
3. **การวิเคราะห์ช่วงเวลา** - จัดกลุ่มโครงการตามไตรมาสหรือปีงบประมาณ
4. **การสร้างรายงานแผนภูมิ** - เปรียบเทียบสัดส่วนโครงการแต่ละประเภทหรือแต่ละคณะ

### ตัวอย่างการวิเคราะห์จากข้อมูล Tidy

1. งบประมาณรวมแยกตามประเภทโครงการ:
   ```
   =SUMIFS(งบประมาณ, ประเภทวิจัย, 1)
   =SUMIFS(งบประมาณ, ประเภทบริการวิชาการ, 1)
   =SUMIFS(งบประมาณ, ประเภททำนุบำรุงศิลปวัฒนธรรม, 1)
   ```

2. จำนวนโครงการแยกตามคณะและประเภท:
   ```
   =COUNTIFS(คณะ, "วิทยาศาสตร์", ประเภทวิจัย, 1)
   ```

3. งบประมาณเฉลี่ยต่อโครงการแยกตามคณะ:
   ```
   =AVERAGEIFS(งบประมาณ, คณะ, "วิทยาศาสตร์")
   ```

## ตัวอย่างคำถามที่สามารถวิเคราะห์ได้ง่ายจากข้อมูล Tidy:

1. คณะใดได้รับงบประมาณรวมสูงสุด?
2. ประเภทโครงการใดมีจำนวนโครงการมากที่สุด?
3. โครงการที่มีระยะเวลาดำเนินการนานที่สุดคือโครงการใด?
4. มีกี่โครงการที่ดำเนินการในช่วงไตรมาสที่ 2 ของปี 2565?
5. ภาควิชาใดมีโครงการมากที่สุด?